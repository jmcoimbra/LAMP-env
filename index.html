<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta id="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <style type="text/css">
        .table-of-contents ul {
            list-style-type: none;
        }
        .table-of-contents li {
            margin: 0 0 0.25em 0;
        }
        .table-of-contents a {
            text-decoration: none;
        }
        .table-of-contents a:hover,
        .table-of-contents a:active {
            text-decoration: underline;
        }

        h3:target {
            animation: highlight 1s ease;
        }
        p {text-align: justify;}
        .refs p {text-align: left;}
    </style>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>LAMP Development Environment for Linux</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>LAMP Development Environment for Linux</h1>
        <h2>Best Practices For PHP Development Using Linux</h2>
        <a href="https://github.com/jmcoimbra/LAMP-env" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
            <article>
                <nav class="table-of-contents" role='navigation'></nav>
                 
                <h3 id="Introduction">Introduction</h3>

                <p>This article will provide an environment to develop websites using LAMP (Linux, Apache, MySQL and PHP).
                   The Linux distribution used here is Ubuntu (64 bit), but you can apply the instructions that will follow 
                   to your beloved Linux distro.
                </p>
                <p>By the time of writing, Ubuntu is on version 14 and the version of all applications and servers within 
                   this article will follow the latest version we can get from Ubuntu&rsquo;s software repositories.
                </p>
                <p>If you plan to install and work with Ubuntu&rsquo;s distribution, please refer to their website, 
                   <a target="_blank" href="http://www.ubuntu.com/">http://www.ubuntu.com/</a>, to download the 
                   &ldquo;Desktop&rdquo; version, in the other hand, if you plan to create a Vagrant
                   <sup><a href="#ftnt1" id="ftnt_ref1">[1]</a></sup>&nbsp;like Virtual Machine, please consider Ubuntu 
                   &ldquo;Server&rdquo;. This article will not cover the installation of Ubuntu, it is already very well 
                   documented, just follow the links within their download page.&nbsp;If you have any concern or get stuck 
                   with any issue, count on their community help, 
                   <a target="_blank" href="http://askubuntu.com/">http://askubuntu.com/</a>, or read their guide to get 
                   familiar with this Operational System (<a target="_blank" href="https://help.ubuntu.com/14.04/index.html">https://help.ubuntu.com/14.04/index.html</a>)
                   and, of course, searching the internet.
                </p>
                <p>The article is split with LAMP installation and configuration - including the best Apache configuration we
                    can get to speed up websites first configuration on Linux. Then we will go after Chrome browser, XDebug
                    and a self signed SSL Certificate to develop and test under HTTPS. The scope is to cover &ldquo;the
                    development environment&rdquo; and ensure that every application cited will be ready to be used - so opinions
                    regarding IDEs, how to use Chrome for development, or how to use XDebug, or if you should use SASS or LESS or
                    how you will test your software is all out of scope. A Linux basic knowledge is assumed to fully
                    understand this article.
                </p>
                <p>Searching for similar content in the internet will give you a plenty of links, but the main reason of this
                   article is to have the best practices for PHP development for web in one place - that said,
                   you are invited to send your opinions, suggestions and collaborate with a better article when it is a time 
                   for an update.
                </p>

                <h3 id="Going_LAMP">Going LAMP</h3>
                
                <p>As explained by the <a href="#Introduction">Introduction</a>, Linux (the &ldquo;L&rdquo; of our LAMP)
                    will be Ubuntu&rsquo;s distribution.
                </p>
                <p>Let&rsquo;s start considering that you are already reading this article from your Ubuntu. It is always a good
                    practice to maintain all software repositories<sup><a href="#ftnt2" id="ftnt_ref2">[2]</a></sup>&nbsp;up to date
                    before installing them, therefore execute the command below to have their latest version:
                </p>
                
                <pre><code>$ sudo apt-get update</code></pre>

                <h4><a id="Apache"></a>Apache</h4>
                
                <p>Apache (server-side) will be our web server, where PHP code will be executed and respond to requests coming 
                    from the client side, usually the browser installed on the end-user device or personal computer.
                </p>
                <p>To install apache, execute:</p>
                
                <pre><code>$ sudo apt-get install apache2</code></pre>
                
                <p>Your webserver is going to be installed after you accept the question that will follow. When apt-get finishes,
                    you can browse <a target="_blank" href="http://localhost/">http://localhost/</a> and see the &ldquo;Apache2 Ubuntu Default Page&rdquo;
                    - see <a href="#Appendix_A">Appendix A</a>.
                </p>
                <p>It will be nice if we tell Apache from where it should serve requests, to do so you need to edit /etc/apache2/apache2.conf
                    with your desired editor and add the line &ldquo;ServerName localhost&rdquo;:
                </p>
                
                <pre><code>$ sudo gedit etc/apache2/apache2.conf
# Now add the line below right after the &quot;Global configuration&quot;
# section comments:
ServerName localhost</code></pre>
                
                <p>Ok, now that you have Apache installed you will notice that you must always use the sudo command to start
                    creating websites within /var/www. To avoid doing &ldquo;sudos&rdquo; all the time, the author of this 
                    article prefers to be part of the www-data group, that Apache uses to serve the requests, because it is
                    implicit that we are going to be the only user accessing /var/www. So we can work on code directly under
                    /var/www, but we can also have projects that your user owns at any directory, for instance under our 
                    HOME directory, symlinked to /var/www.
                </p>
                <p>So, lets add your user to the www-data group:</p>
                
                <pre><code>$ sudo gpasswd -a &quot;$USER&quot; www-data</code></pre>
                
                <p>Also, lets change the ownership of any previously created files and directories:</p>
                
                <pre><code>$ sudo chown -R &quot;$USER&quot;:www-data var/www
$ find /var/www -type f -exec chmod 0660 {} \; 
$ sudo find /var/www -type d -exec chmod 2770 {} \;</code></pre>
                
                <p>After executing the commands above, /var/www will be owned by your user, under the group www-data,
                    where Apache runs. The other commands are related to security: the second one makes just you and
                    www-data group able to read and write all the files under /var/www and the third command
                    <sup><a href="#ftnt3" id="ftnt_ref3">[3]</a></sup> will ensure that only the owner of files within 
                    /var/www can unlink or rename those files.
                </p>
                
                <h4><a id="h.Apache_mod"></a>Apache mod_vhost_alias and dnsmasq</h4>
                
                <p>When using Apache, developers usually work with Apache&rsquo;s vhosts and write specific domains on 
                    /etc/hosts file, so they can have a development environment for a project.
                </p>
                <p>Now it is time to think about when you have more than one web project to develop, assuming that you
                    will have symlinks or entire websites under /var/www - it will be required that you have a quick site
                    setup, it could be for starting a new project, or working on new features or even when you are responsible
                    for fixing bugs or helping with savvy issues on websites already in production.
                </p>
                <p>The Apache&rsquo;s vhosts_alias module and a local DNS is up to this task. Working with it gives the
                    possibility to any directory we create to be already a vhost - yes, we can have a dynamic vhosts creation.
                    The local DNS, considering dnsmasq<sup><a href="#ftnt4" id="ftnt_ref4">[4]</a></sup> application, will
                    provide a way to have a common top-level domain for development, like &ldquo;dev&rdquo; - for instance,
                    we could access /var/www/project1.dev browsing for http://project1.dev/. The consequences of this
                    configuration will be:
                </p>
                <ol>
                    <li>.htaccess needs to have the &ldquo;RewriteBase /&rdquo; directive in the top level directory;</li>
                    <li>All logs will go to the same file, since we will use just one vhost file to catch all requests.</li>
                </ol>
                <p>Lets enable mod_rewrite for RewriteBase directive:</p>
                
                <pre><code>$ sudo a2enmod rewrite</code></pre>
                
                <p>Now lets enable the mod_vhost_alias:</p>
                
                <pre><code>$ sudo a2enmod vhost_alias</code></pre>
                
                <p>From here you can configure a vhost to catch all requests, adapting it to your setup needs. I suggest
                    just editing the /etc/apache2/sites-enabled/000-default.conf:
                </p>
                
                <pre><code>$ sudo gedit /etc/apache2/sites-enabled/000-default.conf <br />
# Feel free to copy and paste the configuration below
&lt;VirtualHost *:80&gt;
    ServerName vhosts.dev
    VirtualDocumentRoot "/var/www/%0"
    ServerAlias *.dev
    UseCanonicalName Off

    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
    # error, crit, alert, emerg.
    # It is also possible to configure the loglevel for particular
    # modules, e.g.
    #LogLevel info ssl:warn
    LogLevel warn

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    &lt;Directory "/var/www/*"&gt;
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
                
                <p>Please, refer to the documentation webpage of Apache mod_vhost_alias (on the
                    <a class="c3" href="#References">References</a>) to learn more about this &ldquo;%0&rdquo; on
                    the VirtualDocumentRoot directive.
                </p>
                <p>To start using this awesome feature, just restart Apache:</p>
                
                <pre><code>$ sudo service apache2 restart</code></pre>
                
                <p>If you go to /var/www and try to test this feature, you will get issues Linux&rsquo;s 
                    /etc/hosts doesn&rsquo;t understand a wildcard character like &ldquo;*&rdquo;. Lets install and 
                    configure dnsmasq to make it worth:
                </p>

                <pre><code>$ sudo apt-get install dnsmasq</code></pre>

                <p>Next, edit dnsmasq.conf file and add the following lines to the bottom:</p>

                <pre><code>$ sudo gedit /etc/dnsmasq.conf

# Lines to be added on /etc/dnsmasq.conf:
listen-address=127.0.0.1
address=/.dev/127.0.0.1</code></pre>
                <p>Restart dnsmasq:</p>

                <pre><code>$ sudo service dnsmasq restart</code></pre>

                <p>Now you can check that any domain finishing with &ldquo;dev&rdquo; will be served by your localhost:</p>

                <pre><code>$ host test.dev</code></pre>
                
                <p>The expected result of the command above is: &ldquo;test.dev has address 127.0.0.1&rdquo;.</p>
                <p>If you create a directory /var/www/test.dev, then create a index.html file and write a
                    &ldquo;Hello World&rdquo; there, you will see it working browsing <a href="http://test.dev/">http://test.dev/</a>
                    - if you just installed Apache, you can rename that &ldquo;html&rdquo; directory to 
                    &ldquo;test.dev&rdquo;.
                </p>
                <p>Lets say you need a URL like test2.local as an exception, you can edit the first line of /etc/hosts, e.g.:</p>
                <p>127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localhost test2.local</p>
                <p>Then create the directory /var/www/test2.local and copy your project files inside.
                    I am using this specific &ldquo;.local&rdquo; as an example of top-level domain because Ubuntu already
                    uses it<sup><a href="#ftnt5" id="ftnt_ref5">[5]</a></sup> - if try it as your top-level domain for
                    dynamic vhosts, it will not work. You can also use your own IP to be a symlink to a directory, if you
                    want someone browsing your local project using your IP.
                </p>
        
                <h4><a id="SSL_Certificate"></a>SSL Certificate (HTTPS)</h4>
                <p>You Apache server answers requests coming from port 80 already, this is the HTTP protocol, but when you 
                    need to develop a website using HTTPS, that uses port 443, you are going to need to perform the steps below.
                </p>
                <p>SSL support actually comes standard in the Ubuntu 14.04 Apache package. We simply need to enable it to take 
                    advantage of SSL on our system.
                </p>
                
                <pre><code>$ sudo a2enmod ssl</code></pre>
                
                <p>Now it is time to create a self-signed certificate under /etc/apache2/ssl:0/p>

                <pre><code>sudo mkdir /etc/apache2/ssl

sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt</code></pre>
                
                <p>You will need to answer some basic questions for you self-signed certificate. It can be something like this:</p>
                <p>Country Name (2 letter code) [AU]: BR<br />
                   State or Province Name (full name) [Some-State]: Sao Paulo<br />
                   Locality Name (eg, city) []: Campinas<br />
                   Organization Name (eg, company) [Internet Widgits Pty Ltd]: Your Company<br />
                   Organizational Unit Name (eg, section) []: Your Department/Section<br />
                   Common Name (e.g. server FQDN or YOUR name) []: your_domain.com<br />
                   Email Address []: your_email@domain.tld
                </p>
                <p>We are going to use /etc/apache2/sites-available/default-ssl.conf, since it is the sibling of
                    000-default.conf that we used to all requests from &ldquo;dev&rdquo; top-level domain.
                </p>
                
                <pre><code>&lt;IfModule mod_ssl.c&gt;
  &lt;VirtualHost _default_:443&gt;
    DocumentRoot /var/www/
    VirtualDocumentRoot /var/www/%0

    LogLevel warn
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    SSLEngine on
    SSLCertificateFile	/etc/apache2/ssl/apache.crt
    SSLCertificateKeyFile /etc/apache2/ssl/apache.key

    &lt;FilesMatch "\.(cgi|shtml|phtml|php)$"&gt;
      SSLOptions +StdEnvVars
    &lt;/FilesMatch&gt;
    &lt;Directory /usr/lib/cgi-bin>
      SSLOptions +StdEnvVars
    &lt;/Directory&gt;

    BrowserMatch "MSIE [2-6]" \
      nokeepalive ssl-unclean-shutdown \
      downgrade-1.0 force-response-1.0
    BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
  &lt;/VirtualHost&gt;
&lt;/IfModule&gt;</code></pre>
                
                <p>Activate this brand new virtual host for &ldquo;dev&rdquo; top-level domains requesting HTTPS protocol:</p>
                
                <pre><code>$ sudo a2ensite default-ssl.conf</code></pre>
                
                <p>You&#39;ll have to restart the web server for recognizing all changes:</p>

                <pre><code>$ sudo service apache2 restart</code></pre>

                <p>It is time to test your configuration browsing <a href="https://test.dev/">https://test.dev/</a> - accept the 
                    self-signed certificate and that is it!
                </p>
                
                <h4><a id="PHP"></a>PHP</h4>
                <p>To have PHP fully working on your environment, you need it integrated with Apache and the operational 
                    system&rsquo;s recognition of this language, so you will need to install the packages below:
                </p>
                
                <pre><code>$ sudo apt-get install php5 libapache2-mod-php5</code></pre>
                
                <p>The command above will prepare Apache to run PHP scripts within a web page and also will restart Apache for you.</p>
                <p>Now it is time to play, lets create a dir /var/www/phpinfo.dev and a index.php file with a call to 
                    phpinfo()<sup><a href="#ftnt6" id="ftnt_ref6">[6]</a></sup>.
                </p>
                
                <pre><code>$ mkdir /var/www/phpinfo.dev
$ echo '&lt;?php phpinfo() ?&gt;' > /var/www/phpinfo.dev/index.php</code></pre>
                
                <p>When browsing <a href="http://phpinfo.dev">http://phpinfo.dev</a>
                    you will see the phpinfo function output. You just have the latest PHP version from Ubuntu&rsquo;s software
                    repository working with your Apache server.
                </p>
                
                <h4><a id="MySQL"></a>MySQL</h4>
                
                <p>To have MySQL database working and also ensure the integration with PHP:</p>
                
                <pre><code>$ sudo apt-get install php5-mysql mysql-server</code></pre>
                
                <p>You will be asked to set your MySQL&rsquo;s root user password. After all the installation, try to connect 
                    to your database:
                </p>
                
                <pre><code>$ mysql -u root -p</code></pre>
                
                <p>Type your root password and perform some MySQL commands, like &ldquo;show databases;&rdquo; and then 
                    &ldquo;exit.
                </p>
                <p>Feel free to use a graphical user interface application to work with MySQL, like MySQL Workbench
                    <sup><a href="#ftnt7" id="ftnt_ref7">[7]</a></sup>, or phpMyAdmin
                    <sup><a href="#ftnt8" id="ftnt_ref8">[8]</a></sup>. The author prefers MySQL Workbench.
                </p>
                
                <pre><code>$ sudo apt-get install mysql-workbench</code></pre>
                
                <h3 id="Developing">Developing with quality</h3>
                
                <p>When developing software, quality is non negotiable - so you must use tools to help building your software 
                    in the best way. The next topics will prepare your environment to have a minimum setup for this goal.
                </p>
                
                <h4 class="c0 c25"><a id="Chrome_Browser"></a>Chrome Browser</h4>
                
                <p>Chrome is a top-notch browser for development, it has good solutions ranging from styling web pages
                    to javascript debugging.
                </p>
                <p>As per <a target="_blank" href="http://www.ubuntuupdates.org/ppa/google_chrome">http://www.ubuntuupdates.org/ppa/google_chrome</a>:</p>
                
                <pre><code>$ wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
$ sudo sh -c 'echo "deb http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'
$ sudo apt-get update
$ sudo apt-get install google-chrome-stable</code></pre>
                
                <p>After executing those commands you will have Chrome Browser ready in you Ubuntu software repositories and
                    it will update when a new version of Chrome is released.
                </p>
                <p>Explore <a target="_blank" href="https://developer.chrome.com/">https://developer.chrome.com/</a> and catch up
                    with Chrome&#39;s tools for developers.
                </p>
                
                <h4><a id="Xdebug"></a>Xdebug</h4>
                
                <p>Xdebug is an extension to PHP, it will add functions for debugging and you can also integrate it to your IDE, so
                    you can breakpoint your code where the PHP execution should stop and you can see the call stack and variables 
                    values. Let&rsquo;s install and configure it without further ado:
                </p>
                
                <pre><code>$ sudo apt-get install php5-xdebug
$ grep -R "xdebug.so" /usr/lib/php5/
# Use the path indicated on the result of the last command on php.ini
# E.g.: "Binary file /usr/lib/php5/20121212/xdebug.so matches" will give the path
# for zend_extension parameter

$ sudo gedit /etc/php5/apache2/php.ini

# Copy and paste the configuration below at the end of the file
# Xdebug configuration
zend_extension="/usr/lib/php5/20121212/xdebug.so"
xdebug.remote_enable = 1
# Close the editor

$ sudo service apache2 restart</code></pre>
                
                <p>For Ubuntu 14 you just need to ensure that xdebug.remote_enable setting is &ldquo;on&rdquo;, so your IDE will
                    listen to your localhost on port 9000 and your breakpoints will work.
                </p>
                <p>Browse <a target="_blank" href="http://phpinfo.dev">http://phpinfo.dev</a> again (that index.php file 
                    we&rsquo;ve created on the <a class="c3" href="#PHP">PHP topic</a>) and search for &ldquo;xdebug&rdquo;, 
                    notice that you have a new 20-xdebug.ini parsed as extra configuration for Apache and also a new entire
                    information section called &ldquo;xdebug&rdquo;, showing all settings values.
                </p>
                
                <h4><a id="SCM"></a>Source Control Management</h4>
                
                <p>I hope you consider working with any revision control tool, even if you are working alone. Git, for 
                    instance, can do it locally. But lets consider that you will work with others and SCM is needed. Lets
                    prepare your PC to deal with Git and Subversion.
                </p>
                
                <pre><code>$ sudo apt-get install git subversion</code></pre>
                
                <p>This is the most common revision control applications, Git for distributed version control and SVN 
                    for centralized repositories.
                </p>
                
                <h3 id="PHPFarm">PHPFarm</h3>
                
                <p>If you need to work with an older version of PHP - for compatibility reasons, or if you want to test any 
                    beta version of PHP, then you will need to work with different versions of PHP that Ubuntu has on its 
                    repositories. It is a common knowledge that working with PHP natively on your development environment is
                    the best solution, and it would be awesome to have PHP versions co-existing with no conflicts - PHPFarm 
                    is up to this task!
                </p>
                <p>The author of this article suggests to skip this installation if you don&rsquo;t need to work with different
                    versions of PHP. Be warned that you will prepare you operational system to compile PHP, so it will have 
                    more software packages installed.
                </p>
                
                <h4><a id="Installing_PHPFarm"></a>Installing PHPFarm</h4>
                
                <p>Let&rsquo;s get the zip file of user cweiske&rsquo;s<sup><a href="#ftnt9" id="ftnt_ref9">[9]</a></sup>
                    master branch from GitHub and install under /opt directory (you can also use git to clone his repository):
                </p>
                
                <pre><code>$ cd ~/Downloads
$ wget https://github.com/cweiske/phpfarm/archive/master.zip
$ sudo unzip master.zip -d /opt/
$ cd /opt
$ sudo mv phpfarm-master phpfarm</code></pre>
                
                <p>Integrate the phpfarm to your PATH:</p>
                
                <pre><code>$ echo "export PATH=/opt/phpfarm/inst/bin:$PATH" >> ~/.bashrc
$ source ~/.bashrc</code></pre>
                
                <p>Now, it is time to ensure that we will have all dependencies installed to compile a PHP 
                    version and to have Apache serving under FastCGI.
                </p>
                
                <pre><code># Packages
$ sudo apt-get install apache2-suexec php5-dev php5-curl php5-gd php5-intl php-pear php5-imagick php5-mcrypt php5-memcache php5-snmp php5-sqlite php5-tidy php5-xmlrpc php5-xsl libapache2-mod-fastcgi snmp libxpm-dev libjpeg-dev libpng++-dev libpspell-dev

# Compilers
$ sudo apt-get install autoconf automake curl build-essential re2c libxml2-dev

# Lib Mysql
$ sudo apt-get install libmysql++-dev

# curl
$ sudo apt-get install libcurl4-gnutls-dev

# php5-mcrypt
$ sudo apt-get install libmcrypt-dev

# php5-xsl
$ sudo apt-get install libxslt1-dev

# List of PHP extensions
$ sudo apt-get install libapache2-mod-php5 php5-cli php5-common php5-ming php5-ps php5-pspell php5-recode php5-sqlite

# Enable Apache modules
$ sudo a2enmod actions fastcgi suexec cgi rewrite
$ sudo service apache2 restart</code></pre>
                
                <h4><a id="Example"></a>Example: using PHP version 5.4.0</h4>
                
                <p>Lets start configuring our custom-options-5.4.0.sh file:</p>
                
                <pre><code>$ cd /opt/phpfarm/src
$ sudo gedit custom-options-5.4.0.sh

# Copy and paste the text below
configoptions="
        --with-libdir=/lib/x86_64-linux-gnu \
        --with-openssl \
        --with-pear \
        --with-iconv \
        --with-curl \
        --with-mysqli \
        --with-mysql \
        --enable-mbstring \
        --enable-exif \
        --with-jpeg-dir=/usr \
        --with-png-dir=/usr \
        --with-zlib \
        --with-zlib-dir \
        --with-png-dir=/usr \
        --with-gd \
        --with-gettext \
        --enable-gd-native-ttf \
        --with-mhash \
        --enable-ftp \
        --with-pspell \
        --with-mcrypt \
        --enable-bcmath \
        --with-pdo-mysql \
        --enable-sockets \
        --enable-soap \
        --enable-calendar"

include_path=".:/opt/phpfarm/inst/php-$version/pear/php/"
display_errors=On
log_errors=On
error_log=/tmp/php_errors.log

# Close the editor!

$ sudo chmod 755 custom-options-5.4.0.sh</code></pre>
                
                <p>Now we can compile PHP version 5.4.0:</p>
                
                <pre><code>$ sudo ./compile.sh 5.4.0</code></pre>
                
                <p>This first try will fail, because we need to patch libxml2-2.9.0<sup><a href="#ftnt10" id="ftnt_ref10">[10]</a></sup>:</p>
                
                <pre><code>$ cd php-5.4.0
$ sudo wget https://mail.gnome.org/archives/xml/2012-August/txtbgxGXAvz4N.txt
$ sudo patch -p0 -b &lt; txtbgxGXAvz4N.txt
$ cd ..
# Try again to be happy!
$ sudo ./compile.sh 5.4.0
# Test your build
$ cd ../inst/php-5.4.0/bin
$ ./php -v</code></pre>
                
                <p>This last command will give you an output like below:</p>
                <p>PHP 5.4.0 (cli) (built: Aug 26 2014 20:30:43) (DEBUG)<br />
                   Copyright (c) 1997-2012 The PHP Group<br />
                   Zend Engine v2.4.0, Copyright (c) 1998-2012 Zend Technologies
                </p>
                <p>As you can see, PHP is running on version 5.4.0.</p>
                
                <h4><a id="Apache_new"></a>Apache new dynamic host for a specific PHP version</h4>
                
                <p>To start integrating it with your development environment, we will need to ensure your localhost can answer
                    for a new domain, like &ldquo;dev54&rdquo; (development with PHP 5.4), then we will configure Apache 
                    server, dnsmasq server and configure the CGI for Apache.
                </p>
                <p>In order to avoid conflicts, the author recommends using a new localhost IP, like &ldquo;127.0.0.3&rdquo;.</p>
                <p>Lets start a new site on Apache server, let&rsquo;s create a new site configuration:</p>
                
                <pre><code>$ sudo gedit /etc/apache2/sites-available/default54.conf</code></pre>
                
                <p>Copy and paste the configuration below:</p>
                
                <pre><code>&lt;VirtualHost 127.0.0.3:80&gt;
  ServerName vhosts.dev54
  VirtualDocumentRoot "/var/www/%0"
  ServerAlias *.dev54
  UseCanonicalName Off

  # Possible values include: debug, info, notice, warn, error, crit,
  # alert, emerg.
  LogLevel debug
  CustomLog ${APACHE_LOG_DIR}/access54.log combined
  ErrorLog ${APACHE_LOG_DIR}/error54.log

  ScriptAlias /php-fcgi/ /var/www/cgi-bin/

  &lt;Directory "/var/www/"&gt;
	Options Indexes FollowSymLinks MultiViews
	AllowOverride All
	Order allow,deny
	allow from all
    
	AddHandler php-cgi .php
	Action php-cgi /php-fcgi/php-cgi-5.4.0
	&lt;FilesMatch "\.php$"&gt;
  		SetHandler php-cgi
	&lt;/FilesMatch&gt;
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;

&lt;Virtualhost 127.0.0.3:443&gt;
  ServerName vhosts.dev54
  DocumentRoot "/var/www"

  SSLEngine On
  SSLCertificateFile /etc/apache2/ssl/apache.crt
  SSLCertificateKeyFile /etc/apache2/ssl/apache.key
  ServerSignature On

 # Possible values include: debug, info, notice, warn, error, crit,
 # alert, emerg.
 LogLevel debug
 CustomLog ${APACHE_LOG_DIR}/access54.log combined
 ErrorLog ${APACHE_LOG_DIR}/error54.log
    
 ScriptAlias /php-fcgi/ /var/www/cgi-bin/

  &lt;directory "/var/www"&gt;
	Options Indexes FollowSymLinks MultiViews
	AllowOverride all
	Order allow,deny
	allow from all

	AddHandler php-cgi .php
	Action php-cgi /php-fcgi/php-cgi-5.4.0
	&lt;FilesMatch "\.php$"&gt;
  		SetHandler php-cgi
	&lt;/FilesMatch&gt;
  &lt;/directory&gt;
&lt;/virtualhost&gt;</code></pre>
                
                <p>This configuration will make your Apache server work with CGI - that we will configure soon, integrating
                    with PHPFarm generated scripts of our chosen PHP version - and will ensure that all domain ending with 
                    &ldquo;dev54&rdquo; is going to use PHP 5.4.0. Let&rsquo;s enable it:
                </p>
                
                <pre><code>$ sudo a2ensite default54
$ sudo service apache2 reload</code></pre>
                
                <h4><a id="dnsmasq_serving"></a>dnsmasq serving a new domain for a specific PHP version</h4>
                
                <p>To recognize your &ldquo;*.dev54&rdquo; on the Apache configuration, we are going to use dnsmasq, like 
                    we did before start using PHPFarm. Add this configuration on the end of your 
                    /etc/dnsmasq.conf:
                </p>
                
                <pre><code>$ echo "listen-address=127.0.0.3" | sudo tee --append /etc/dnsmasq.conf
$ echo "address=/dev54/127.0.0.3" | sudo tee --append /etc/dnsmasq.conf
$ sudo service dnsmasq restart</code></pre>
                
                <h4><a id="FastCGI"></a>FastCGI for Apache Integration</h4>
                
                <p>Then we need to create the configuration for CGI, integrating with PHPFarm generated script on 
                    /opt/phpfarm/inst/bin/php-cgi-5.4.0.
                </p>
                
                <pre><code>$ mkdir /var/www/cgi-bin
$ gedit /var/www/cgi-bin/php-cgi-5.4.0

# Paste the configuration below:
#!/bin/sh
PHP_FCGI_CHILDREN=3 
export PHP_FCGI_CHILDREN 
PHP_FCGI_MAX_REQUESTS=5000 
export PHP_FCGI_MAX_REQUESTS 
exec /opt/phpfarm/inst/bin/php-cgi-5.4.0

# Close gedit
$ chmod 775 /var/www/cgi-bin/php-cgi-5.4.0</code></pre>
                
                <p>Well, if you&rsquo;ve followed this article, you have /var/www/phpinfo.dev/index.php, that uses the 
                    latest version of PHP for Ubuntu Trusty Tahr (version 14), so we can now play with it:
                </p>
                
                <pre><code>$ cd /var/www
$ ln -s phpinfo.dev phpinfo.dev54</code></pre>
                
                <p>Yes, we can create a symbolic link to this same directory, using our new domain. If you browse 
                    <a target="_blank" href="http://phpinfo.dev54">http://phpinfo.dev54</a>, you will see that
                    phpinfo function prints &ldquo;PHP Version 5.4.0&rdquo;. Now you can create projects and compare 
                    how it is working for different versions of PHP. Go ahead and compile more PHP versions and create 
                    dynamic hosts for them!
                </p>
                
                <h4><a id="Xdebug_for"></a>Xdebug for a specific PHP version</h4>
                
                <p>Quoting Weiske (2011), &ldquo;When using several PHP installations with phpfarm, installing PHP extensions 
                    is not always easy - mostly because Pyrus is very strict about package files - and many of the packages in
                    PECL unfortunately have invalid non-validating package.xml&rsquo;s.&rdquo;
                </p>
                <p>So we need to install and configure Xdebug for our specific PHP version. Please, note that you will download 
                    the latest version of Xdebug, so the name of the file may change.
                </p>
                
                <pre><code>$ cd /opt/phpfarm/
$ sudo pear download pecl/xdebug
$ sudo tar xzvf xdebug-2.2.5.tgz</code></pre>
                
                <p>According to Weiske (2011), the two things to remember are to use the correct phpize and 
                    php-config for the specific PHP version:
                </p>
                
                <pre><code>$ cd xdebug-2.2.5
$ sudo /opt/phpfarm/inst/bin/phpize-5.4.0
# It will give us this output:
  Configuring for:
  PHP Api Version:         20100412
  Zend Module Api No:      20100525
  Zend Extension Api No:   220100525
$ sudo ./configure --with-php-config=/opt/phpfarm/inst/bin/php-config-5.4.0
$ sudo make
$ sudo make install</code></pre>
                
                <p>We need to enable the extension in our php.ini file:</p>
                
                <pre><code>$ sudo gedit /opt/phpfarm/inst/php-5.4.0/lib/php.ini

# Copy and paste this configuration on the end of this file
; Xdebug configuration
zend_extension="/opt/phpfarm/inst/php-5.4.0/lib/php/extensions/debug-non-zts-20100525/xdebug.so"
xdebug.remote_enable=1
xdebug.remote_handler=dbgp
xdebug.remote_mode=req
xdebug.remote_host=127.0.0.1
xdebug.remote_port=9000

# Save and close the editor

$ sudo service apache2 restart</code></pre>
                
                <p>When you browse <a target="_blank" href="http://phpinfo.dev54/">http://phpinfo.dev54/</a>, the &ldquo;Xdebug 
                    2.2.5&rdquo; will be next to Zend Engine logo.
                </p>
                <p>Now it is possible to integrate Xdebug with your IDE and you can debug the specific domain for a PHP version,
                    it will use its configured extensions.
                </p>
                
                <h3 id="Conclusions">Conclusions</h3>
                
                <p>As stated on the Introduction, now you can enjoy a PHP web development environment that is able to create
                    a virtual host based on your directory name under /var/www, ready to use MySQL databases, HTTP and HTTPS
                    protocols, debug and even test the same website for different PHP versions - all with native installations!
                </p>
                <p>This great environment is something that developers may take some time to work with, so please take your 
                    time to evolve it writing your own scripts to speed up your development and your software quality, then 
                    build Virtual Machines in order easy your PHP web development environment for your projects. The author 
                    wrote this article to share his knowledge, then feel free to get in touch and share with your coworkers.
                </p>
                
                <h3 id="references">References</h3>
                
                <div class="refs">
                    <p>Ubuntu Wiki, ApacheMySQLPHP.
                        <a target="_blank" href="https://help.ubuntu.com/community/ApacheMySQLPHP">https://help.ubuntu.com/community/ApacheMySQLPHP</a>.
                        Last visited on August 2nd, 2014.
                    </p>
                    <p>Documentation webpage of Apache Module mod_vhost_alias,
                        <a target="_blank" href="http://httpd.apache.org/docs/2.2/mod/mod_vhost_alias.html">http://httpd.apache.org/docs/2.2/mod/mod_vhost_alias.html</a>.
                        Last visited on August 2nd, 2014.
                    </p>
                    <p>Rob Allen, Automatic Apache vhosts.
                        <a target="_blank" href="http://akrabat.com/computing/automatic-apache-vhosts/">http://akrabat.com/computing/automatic-apache-vhosts/</a>.
                        Last visited on August 3rd, 2014.
                    </p>
                    <p>Ask Ubuntu website, How to avoid using sudo when working in /var/www?. 
                        <a target="_blank" href="http://askubuntu.com/questions/46331/how-to-avoid-using-sudo-when-working-in-var-www">http://askubuntu.com/questions/46331/how-to-avoid-using-sudo-when-working-in-var-www</a>.
                        Last visited on August 3rd, 2014.
                    </p>
                    <p>Ubuntu 12.04 Server Guide, Databases Section, MySQL.
                        <a target="_blank" href="https://help.ubuntu.com/12.04/serverguide/mysql.html">https://help.ubuntu.com/12.04/serverguide/mysql.html</a>.
                        Last visited on August 12nd, 2014.
                    </p>
                    <p>XDebug Documentation website.
                        <a target="_blank" href="http://xdebug.org/docs/">http://xdebug.org/docs/</a>.
                        Last visited on August 13rd, 2014.
                    </p>
                    <p>Introducing phpfarm, Christian Weiske.
                        <a target="_blank" href="http://cweiske.de/tagebuch/Introducing%20phpfarm.htm">http://cweiske.de/tagebuch/Introducing%20phpfarm.htm</a>.
                        Last visited on August 25th, 2014.
                    </p>
                    <p>Running Apache with a dozen PHP versions, Christian Weiske.
                        <a target="_blank" href="http://cweiske.de/tagebuch/Running%20Apache%20with%20a%20dozen%20PHP%20versions.htm">http://cweiske.de/tagebuch/Running%20Apache%20with%20a%20dozen%20PHP%20versions.htm</a>.
                            Last visited on August 25th, 2014.
                    </p>
                    <p>Compiling and building PHP 5.3 on Ubuntu Linux, Artur Ejsmont.
                        <a target="_blank" href="http://artur.ejsmont.org/blog/content/compiling-and-building-php-53-on-ubuntu">http://artur.ejsmont.org/blog/content/compiling-and-building-php-53-on-ubuntu</a>. 
                        Last visited on August 26th, 2014.
                    </p>
                    <p>Installing PHP extensions for phpfarm, Christian Weiske. 
                        <a target="_blank" href="http://cweiske.de/tagebuch/phpfarm-install-extensions.htm">http://cweiske.de/tagebuch/phpfarm-install-extensions.htm</a>.
                        Last visited on August 29th, 2014.
                    </p>
                </div>
                
                <h3 id="Appendix_A">Appendix A - Apache2 Default Website</h3>
                
                <p>A screenshot of &ldquo;Apache2 Ubuntu Default Page&rdquo;, when browsing 
                    <a target="_blank" href="http://localhost/">http://localhost/</a>.
                </p>
                <p><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 474.50px; height: 755.18px;"><img alt="Apache2-localhost.png" src="images/image00.png" style="width: 474.50px; height: 755.18px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
                
                <hr />
                <div>
                    <p class="c1"><a href="#ftnt_ref1" id="ftnt1">[1]</a><span class="c30">&nbsp;</span><span class="c22"><a class="c3" href="https://www.google.com/url?q=https%3A%2F%2Fwww.vagrantup.com%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGIPqi-jXhXAZJ91ybWAezY-WIfBg">https://www.vagrantup.com/</a></span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref2" id="ftnt2">[2]</a><span class="c30">&nbsp;Ubuntu uses an </span><span class="c30">Advanced Packaging Tool to perform operations on the existing software repositories, if it is new to you, consider reading Ubuntu&rsquo;s documentation on </span><span class="c22"><a class="c3" href="https://www.google.com/url?q=https%3A%2F%2Fhelp.ubuntu.com%2F14.04%2Fserverguide%2Fapt-get.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHV1e6Fhp-XAeon7W1Q0Ee9NK074w">https://help.ubuntu.com/14.04/serverguide/apt-get.html</a></span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref3" id="ftnt3">[3]</a><span class="c30">&nbsp;Execute &ldquo;</span><span class="c17 c30">man chmod</span><span class="c30">&rdquo; on your terminal to read about the sticky bit</span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref4" id="ftnt4">[4]</a><span class="c30">&nbsp;</span><span class="c22"><a class="c3" href="http://www.google.com/url?q=http%3A%2F%2Fwww.thekelleys.org.uk%2Fdnsmasq%2Fdoc.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFpuDpNF_MiT2Voj_VGpOt0vTktgg">http://www.thekelleys.org.uk/dnsmasq/doc.html</a></span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref5" id="ftnt5">[5]</a><span class="c30">&nbsp;Check </span><span class="c22"><a class="c3" href="http://goo.gl/bmTlwr">http://goo.gl/bmTlwr</a></span><span class="c30">&nbsp;and </span><span class="c22"><a class="c3" href="https://www.google.com/url?q=https%3A%2F%2Fhelp.ubuntu.com%2Fcommunity%2FHowToZeroconf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNH0K_loNivgJDrn6GIk_IFC0EBolA">https://help.ubuntu.com/community/HowToZeroconf</a></span><span class="c30">&nbsp;for more information</span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref6" id="ftnt6">[6]</a><span class="c30">&nbsp;</span><span class="c22"><a class="c3" href="http://www.google.com/url?q=http%3A%2F%2Fphp.net%2Fmanual%2Fen%2Ffunction.phpinfo.php&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHLtq1v_tVRTibY9SnC3nHaXwWJqg">http://php.net/manual/en/function.phpinfo.php</a></span><span class="c30">&nbsp;</span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref7" id="ftnt7">[7]</a><span class="c30">&nbsp;</span><span class="c22"><a class="c3" href="http://www.google.com/url?q=http%3A%2F%2Fwww.mysql.com%2Fproducts%2Fworkbench%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFdLqFWZE57RZaPhTpl_ie9tGKQ7A">http://www.mysql.com/products/workbench/</a></span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref8" id="ftnt8">[8]</a><span class="c30">&nbsp;</span><span class="c22"><a class="c3" href="http://www.google.com/url?q=http%3A%2F%2Fwww.phpmyadmin.net%2Fhome_page%2Findex.php&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEsRLn1-siw7jOXgjtu_KEqyAJnIA">http://www.phpmyadmin.net/home_page/index.php</a></span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref9" id="ftnt9">[9]</a><span class="c30">&nbsp;Owner of phpfarm&rsquo;s GitHub repository: </span><span class="c22"><a class="c3" href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fcweiske%2Fphpfarm&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGjehOwGK9BuocBej4bEdUC9OGRJg">https://github.com/cweiske/phpfarm</a></span><span class="c30">&nbsp;</span></p>
                </div>
                <div>
                    <p class="c1"><a href="#ftnt_ref10" id="ftnt10">[10]</a><span class="c30">&nbsp;</span><span class="c22"><a class="c3" href="https://www.google.com/url?q=https%3A%2F%2Fmail.gnome.org%2Farchives%2Fxml%2F2012-August%2Fmsg00028.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEMNC9Cc-6sNfazSIVM2TPZ8xsDUg">https://mail.gnome.org/archives/xml/2012-August/msg00028.html</a></span></p>
                </div>

            </article>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/jmcoimbra/LAMP-env/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/jmcoimbra/LAMP-env/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/jmcoimbra/LAMP-env"></a> is maintained by <a href="https://github.com/jmcoimbra">jmcoimbra</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

    <script src="javascripts/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script src="javascripts/main.js" type="text/javascript"></script>
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-34352208-2");
            pageTracker._trackPageview();
        } catch(err) {}
    </script>

  </body>
</html>
